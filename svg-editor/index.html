<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SVGç·¨è¼¯å™¨ï½œè«æ¯”ç©ºé–“</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        :root { 
            --primary: #00cec9; 
            --bg: #121212;      /* å…¨ç«™æ·±ç‚­ç° */
            --panel: #1e1e1e;   /* å¡ç‰‡æ·±ç° */
            --border: #2c2c2e; 
            --text: #e1e1e1; 
        }
        body.light-mode { --bg: #f5f5f7; --panel: #ffffff; --border: #ddd; --text: #1d1d1f; }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html, body { height: 100%; width: 100%; background: var(--bg); color: var(--text); font-family: -apple-system, BlinkMacSystemFont, sans-serif; overflow: hidden; display: flex; flex-direction: column; }
        
        /* ğŸ“± å›ºå®šé ‚éƒ¨å°èˆª */
        header { height: 60px; padding: 0 20px; background: var(--panel); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; z-index: 1000; flex-shrink: 0; }
        header b { letter-spacing: 1px; font-size: 16px; }

        /* ğŸ–¼ï¸ å›ºå®šé è¦½å€å€å¡Š (ä¸æœƒéš¨æ»¾å‹•æ¢ç§»å‹•) */
        .preview-fixed-area { 
            height: 230px; background: #0a0a0a; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            border-bottom: 1px solid var(--border); flex-shrink: 0; z-index: 900;
        }
        #canvas-bg { 
            width: 110px; height: 110px; 
            background-color: #1e2227; /* ç·¹ç·¹æ¨è–¦åˆå§‹è‰² */
            display: flex; align-items: center; justify-content: center; 
            border: 1px solid #333; border-radius: 16px; transition: transform 0.3s, background-color 0.3s;
            position: relative;
        }
        #svg-target { width: 60%; height: 60%; transition: 0.3s; pointer-events: none; }

        .bg-slider-wrap { width: 180px; margin-top: 15px; text-align: center; }
        .bg-slider-wrap label { font-size: 10px; color: #666; display: block; margin-bottom: 5px; text-transform: uppercase; }
        input[type="range"] { width: 100%; accent-color: var(--primary); cursor: pointer; }

        /* ğŸ“œ ç¨ç«‹æ»¾å‹•é…ç½®å€ */
        .main-scroll-view { flex: 1; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .container { padding: 15px; max-width: 600px; margin: 0 auto; }
        
        .card { background: var(--panel); border-radius: 24px; padding: 22px; margin-bottom: 16px; border: 1px solid rgba(255,255,255,0.03); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .card h4 { font-size: 13px; color: var(--primary); margin-bottom: 18px; display: flex; align-items: center; gap: 8px; }
        .card h4::before { content: ''; width: 3px; height: 13px; background: var(--primary); border-radius: 10px; }
        
        .field { margin-bottom: 18px; }
        label { font-size: 11px; color: #888; display: block; margin-bottom: 8px; }
        select, input[type="color"], .output-box { width: 100%; padding: 14px; background: rgba(0,0,0,0.25); border: 1px solid var(--border); color: inherit; border-radius: 14px; outline: none; font-size: 14px; transition: 0.2s; }
        select:focus, input:focus { border-color: var(--primary); }

        /* è¯å‹•å‹•æ…‹é¡¯ç¤ºé … */
        .logic-gate { display: none; margin-top: 12px; padding: 12px; background: rgba(255,255,255,0.02); border-radius: 10px; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }

        /* è¼¸å‡ºæ§åˆ¶å€ */
        .output-panel { padding: 0 15px 40px; }
        .btn-row { display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .btn { padding: 15px; border-radius: 14px; border: none; font-weight: bold; cursor: pointer; font-size: 13px; display: flex; align-items: center; justify-content: center; gap: 6px; transition: 0.2s; }
        .btn:active { transform: scale(0.96); }
        .btn-primary { background: var(--primary); color: #000; }
        .btn-secondary { background: #2c2c2e; color: #fff; }

        .output-box { min-height: 130px; font-family: 'SF Mono', 'Courier New', monospace; font-size: 12px; line-height: 1.6; white-space: pre-wrap; word-break: break-all; border: 1px solid var(--primary); color: var(--primary); }

        footer { padding: 50px 20px; text-align: center; background: var(--panel); border-top: 1px solid var(--border); }
        .footer-logo { font-weight: 900; font-size: 14px; color: var(--primary); margin-bottom: 10px; letter-spacing: 2px; }
        .copyright { font-size: 10px; color: #555; }

        /* å‹•æ…‹æ¨£å¼è¡¨ */
        .anim-pulse { animation: pulse 2s infinite ease-in-out; }
        .anim-float { animation: float 3s infinite ease-in-out; }
        .anim-rotate { animation: spin 4s infinite linear; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.15); } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body>

<header>
    <i class="fa-solid fa-angle-left" onclick="history.back()"></i>
    <b>SVG ç·¨è¼¯å™¨ï½œè«æ¯”ç©ºé–“</b>
    <i class="fa-solid fa-clock-rotate-left" onclick="showMobiHistory()"></i>
</header>

<div class="preview-fixed-area">
    <div id="canvas-bg">
        <div id="svg-target"></div>
    </div>
    <div class="bg-slider-wrap">
        <label>é è¦½åº•è‰²åˆ‡æ› (æ–æ¡¿)</label>
        <input type="range" min="1" max="5" value="2" oninput="changePreviewBg(this.value)">
    </div>
</div>

<div class="main-scroll-view">
    <div class="container" id="ui-root"></div>
    
    <div class="output-panel">
        <div class="btn-row">
            <button class="btn btn-primary" onclick="generateMobiCode()"><i class="fa-solid fa-wand-magic-sparkles"></i> åŸ·è¡Œç”¢å‡º</button>
            <button class="btn btn-secondary" onclick="copyMobiCode()"><i class="fa-solid fa-copy"></i> è¤‡è£½</button>
            <button class="btn btn-secondary" onclick="clearMobiCode()"><i class="fa-solid fa-eraser"></i> æ¸…é™¤</button>
        </div>
        <div id="code-out" class="output-box" contenteditable="true" placeholder="é»æ“ŠæŒ‰éˆ•ç”¢å‡ºç¨‹å¼ç¢¼..."></div>
        <button class="btn btn-secondary" style="width:100%; margin-top:12px;" onclick="addToMobiFav()"><i class="fa-solid fa-heart"></i> åŠ å…¥è«æ¯”æ”¶è—</button>
    </div>

    <footer>
        <div class="footer-logo">â²˜ğ”¬â²ƒÂ¡â³ğ”­â²ğ” â²‰</div>
        <p class="copyright">è«æ¯”ç©ºé–“ï½œâ²˜ğ”¬â²ƒÂ¡â³ğ”­â²ğ” â²‰ â’¸ 2023-2026</p>
    </footer>
</div>

<script>
    const params = new URLSearchParams(window.location.search);
    const iconName = params.get('icon') || 'power.svg';
    const svgUrl = `https://mobsp.github.io/assets/icon/svg/${iconName}`;

    function changePreviewBg(val) {
        const themes = ["#FFFFFF", "#1e2227", "#555555", "#222222", "#000000"];
        document.getElementById('canvas-bg').style.backgroundColor = themes[val-1];
    }

    async function mobiInit() {
        const root = document.getElementById('ui-root');
        try {
            const res = await fetch('../data/editor_config.json');
            const data = await res.json();
            
            data.ui_groups.forEach(g => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `<h4>${g.group_name}</h4>`;
                
                g.controls.forEach(c => {
                    const field = document.createElement('div');
                    field.className = 'field';
                    field.innerHTML = `<label>${c.label}</label>`;
                    
                    const ctrl = c.type === 'select' ? document.createElement('select') : document.createElement('input');
                    ctrl.id = c.id;
                    if(c.type === 'select') {
                        c.options.forEach(o => ctrl.add(new Option(o, o)));
                        ctrl.onchange = () => { triggerLogic(c.id); updatePreviewUI(); };
                    } else {
                        ctrl.type = c.type; if(c.default) ctrl.value = c.default;
                        ctrl.oninput = updatePreviewUI;
                    }
                    field.appendChild(ctrl);

                    // è¯å‹•ï¼šæ¼¸å±¤æ¨¡å¼ D
                    if(c.id === 'gradient') {
                        const gate = document.createElement('div');
                        gate.id = 'gate-grad'; gate.className = 'logic-gate';
                        gate.innerHTML = `<label>æ¼¸å±¤çµ‚é»è‰²</label><input type="color" id="fill_color_end" value="#ffffff" oninput="updatePreviewUI()">`;
                        field.appendChild(gate);
                    }

                    // è¯å‹•ï¼šè‡ªç”±æ—‹è½‰ C
                    if(c.id === 'rotate_mode') {
                        const gate = document.createElement('div');
                        gate.id = 'gate-rotate'; gate.className = 'logic-gate';
                        gate.innerHTML = `<label>è§’åº¦è£œå„Ÿ (0-360)</label><input type="range" id="free-rotate-val" min="0" max="360" value="0" oninput="updatePreviewUI()">`;
                        field.appendChild(gate);
                    }
                    card.appendChild(field);
                });
                root.appendChild(card);
            });
            updatePreviewUI();
        } catch(e) { console.error("Config Load Error", e); }
    }

    function triggerLogic(id) {
        if(id === 'gradient') {
            document.getElementById('gate-grad').style.display = document.getElementById(id).value.includes('æ¼¸å±¤') ? 'block' : 'none';
        }
        if(id === 'rotate_mode') {
            document.getElementById('gate-rotate').style.display = document.getElementById(id).value === 'è‡ªç”±æ—‹è½‰' ? 'block' : 'none';
        }
        if(id === 'dark_mode_opt') {
            document.body.classList.toggle('light-mode', document.getElementById(id).value.includes('æ·ºè‰²'));
        }
    }

    function updatePreviewUI() {
        const target = document.getElementById('svg-target');
        const fill1 = document.getElementById('fill_color')?.value || '#00cec9';
        const fill2 = document.getElementById('fill_color_end')?.value || '#ffffff';
        const grad = document.getElementById('gradient')?.value;
        const rotateMode = document.getElementById('rotate_mode')?.value;
        const flip = document.getElementById('flip')?.value;
        const anim = document.getElementById('anim_level')?.value;
        const radius = document.getElementById('radius_mode')?.value;

        // ğŸ¨ é¡è‰²èˆ‡æ¼¸å±¤
        target.style.webkitMask = `url(${svgUrl}) no-repeat center / contain`;
        if(grad === 'ç·šæ€§æ¼¸å±¤') target.style.background = `linear-gradient(135deg, ${fill1}, ${fill2})`;
        else if(grad === 'å¾‘å‘æ¼¸å±¤') target.style.background = `radial-gradient(circle, ${fill1}, ${fill2})`;
        else target.style.background = fill1;

        // ğŸ“ åœ“è§’èˆ‡è®Šæ›
        document.getElementById('canvas-bg').style.borderRadius = radius || '16px';
        
        let rotVal = "0deg";
        if(rotateMode === 'è‡ªç”±æ—‹è½‰') rotVal = document.getElementById('free-rotate-val').value + 'deg';
        else rotVal = (rotateMode?.match(/\d+/) || [0])[0] + 'deg';

        let sX = flip === 'æ°´å¹³ç¿»è½‰' ? -1 : 1;
        let sY = flip === 'å‚ç›´ç¿»è½‰' ? -1 : 1;
        target.style.transform = `rotate(${rotVal}) scale(${sX}, ${sY})`;

        // ğŸ¬ å‹•æ…‹é¡å
        target.className = "";
        if(anim?.includes("1")) target.classList.add('anim-pulse');
        if(anim?.includes("2")) target.classList.add('anim-float');
        if(anim?.includes("3")) target.classList.add('anim-rotate');
    }

    function generateMobiCode() {
        const target = document.getElementById('svg-target');
        const size = document.getElementById('size').value;
        const format = document.getElementById('format').value;
        let finalOutput = "";

        if(format.includes("CSS")) {
            finalOutput = `<div style="width:${size}; height:${size}; background:${target.style.background}; -webkit-mask:url('${svgUrl}') no-repeat center/contain; transform:${target.style.transform};"></div>`;
        } else {
            finalOutput = `\n<svg ...> (æ­¤æ ¼å¼éœ€è¦è®€å–åŸå§‹ç¢¼) </svg>`;
        }
        
        document.getElementById('code-out').textContent = finalOutput;
        
        // ğŸ’¾ è‡ªå‹•å„²å­˜è‡³æ­·å²ç´€éŒ„ (L é‚è¼¯)
        const hist = JSON.parse(localStorage.getItem('mobi_edit_history') || '[]');
        hist.unshift({ name: iconName, time: new Date().toLocaleTimeString() });
        localStorage.setItem('mobi_edit_history', JSON.stringify(hist.slice(0, 10)));
    }

    function copyMobiCode() {
        const text = document.getElementById('code-out').textContent;
        if(!text) return alert("è«‹å…ˆåŸ·è¡Œç”¢å‡ºï¼");
        navigator.clipboard.writeText(text).then(() => alert('âœ… å·²è¤‡è£½ä»£ç¢¼'));
    }

    function clearMobiCode() { document.getElementById('code-out').textContent = ""; }

    function addToMobiFav() { alert('ğŸ’– å·²æˆåŠŸåŠ å…¥è«æ¯”æ”¶è—ç›’'); }

    function showMobiHistory() {
        const h = JSON.parse(localStorage.getItem('mobi_edit_history') || '[]');
        alert('ğŸ•’ æœ€è¿‘ç·¨è¼¯ç´€éŒ„ï¼š\n' + (h.length ? h.map(i => `${i.time} - ${i.name}`).join('\n') : 'ç›®å‰å°šç„¡ç´€éŒ„'));
    }

    window.onload = mobiInit;
</script>
</body>
</html>
