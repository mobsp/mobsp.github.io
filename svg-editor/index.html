<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG 編輯器</title>
    <style>
        :root { --bg: #0d1117; --panel: #161b22; --border: #30363d; --accent: #58a6ff; }
        body { margin: 0; display: flex; flex-direction: column; height: 100vh; background: var(--bg); color: white; font-family: sans-serif; }
        @media (min-width: 768px) { body { flex-direction: row; } }
        
        .main-view { flex: 1; display: flex; flex-direction: column; padding: 20px; overflow-y: auto; }
        .preview { flex: 1; background: #1b1f24; border: 1px solid var(--border); border-radius: 8px; display: flex; align-items: center; justify-content: center; min-height: 250px; }
        #svg-target { transition: 0.3s; max-width: 80%; }
        .code-box { margin-top: 15px; background: #000; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 0.8rem; min-height: 80px; word-break: break-all; }
        
        .sidebar { width: 100%; background: var(--panel); border-left: 1px solid var(--border); padding: 20px; box-sizing: border-box; overflow-y: auto; }
        @media (min-width: 768px) { .sidebar { width: 320px; } }
        
        .ctrl-group { margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        label { display: block; font-size: 0.8rem; color: #8b949e; margin: 10px 0 5px; }
        select, input { width: 100%; padding: 8px; background: #0d1117; color: white; border: 1px solid var(--border); border-radius: 4px; }
        button { width: 100%; padding: 12px; background: var(--accent); border: none; border-radius: 6px; color: white; font-weight: bold; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="main-view">
        <div class="preview"><img id="svg-target" src=""></div>
        <div class="code-box" id="output">代碼將在此產生...</div>
        <button onclick="apply()">執行並產生代碼</button>
    </div>
    <div class="sidebar" id="ctrl-panel"><h3>配置選項</h3></div>

    <script>
        const params = new URLSearchParams(window.location.search);
        const icon = params.get('icon') || '';
        const svgUrl = `https://mobsp.github.io/assets/icon/svg/${icon}`;
        document.getElementById('svg-target').src = svgUrl;

        async function loadUI() {
            const res = await fetch('../data/editor_config.json');
            const config = await res.json();
            const panel = document.getElementById('ctrl-panel');
            config.ui_groups.forEach(g => {
                const div = document.createElement('div');
                div.className = 'ctrl-group';
                div.innerHTML = `<h4>${g.group_name}</h4>`;
                g.controls.forEach(c => {
                    const label = document.createElement('label');
                    label.textContent = c.label;
                    let el;
                    if(c.type === 'select') {
                        el = document.createElement('select');
                        c.options.forEach(o => el.add(new Option(o, o)));
                    } else {
                        el = document.createElement('input'); el.type = c.type; if(c.default) el.value = c.default;
                    }
                    el.id = c.id;
                    div.appendChild(label); div.appendChild(el);
                });
                panel.appendChild(div);
            });
        }

        function apply() {
            const s = document.getElementById('size').value;
            const c = document.getElementById('color').value;
            const r = document.getElementById('rotate').value;
            const img = document.getElementById('svg-target');
            img.style.width = s;
            img.style.filter = `drop-shadow(0 0 0 ${c})`;
            img.style.transform = `rotate(${r})`;
            
            document.getElementById('output').textContent = `<img src="${svgUrl}" style="width:${s}; filter:drop-shadow(0 0 0 ${c}); transform:rotate(${r})">`;
        }
        loadUI();
    </script>
</body>
</html>
