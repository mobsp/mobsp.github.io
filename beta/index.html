<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>é«˜ç´šç®¡ç†å¾Œå° | è«æ¯”ç©ºé–“ Beta</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com">

    <style>
        /* é«˜éš CSS è®Šæ•¸ç³»çµ±ï¼šæ”¯æ´å‹•æ…‹ä¸»é¡Œèˆ‡çµ„ä»¶ç¹¼æ‰¿ */
        :root {
            --bg-body: #000000;
            --bg-card: #111111; 
            --bg-input: #222222;
            --text-main: #ffffff;
            --text-sub: #aaaaaa; 
            --accent-color: #06c755; 
            --accent-glow: rgba(6, 199, 85, 0.2);
            --border: #333333;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="light"] {
            --bg-body: #f5f5f7;
            --bg-card: #ffffff;
            --bg-input: #efeff4;
            --text-main: #1c1c1e;
            --text-sub: #8e8e93;
            --border: #d1d1d6;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
            background: var(--bg-body); 
            color: var(--text-main);
            margin: 0; 
            padding: 20px 15px 100px;
            transition: var(--transition);
            font-size: 16px;
            line-height: 1.5;
        }

        .container { max-width: 600px; margin: auto; }

        /* é«˜éšå¡ç‰‡è¨­è¨ˆ */
        .card {
            background: var(--bg-card); 
            padding: 24px;
            border-radius: 20px; 
            margin-bottom: 20px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        h2 { font-size: 1.1rem; margin: 0 0 20px; color: var(--accent-color); display: flex; align-items: center; gap: 10px; }
        
        input, textarea, select {
            width: 100%; padding: 14px; border-radius: 12px;
            border: 1px solid var(--border); background: var(--bg-input); 
            color: var(--text-main); font-size: 14px; margin-bottom: 15px;
            transition: var(--transition); box-sizing: border-box;
        }

        input:focus { border-color: var(--accent-color); outline: none; box-shadow: 0 0 0 3px var(--accent-glow); }

        button {
            width: 100%; padding: 16px; border-radius: 14px;
            background: var(--accent-color); color: white;
            border: none; cursor: pointer; font-weight: 600;
            transition: var(--transition);
        }

        button:hover { filter: brightness(1.1); transform: translateY(-1px); }
        button:active { transform: translateY(0); }

        #output-box {
            background: #0d0d0d; color: #50fa7b; font-family: 'Fira Code', monospace;
            padding: 15px; border-radius: 10px; border: 1px solid #333;
            font-size: 12px; margin-top: 15px; display: none;
            max-height: 250px; overflow: auto;
        }

        /* å°è¦½åˆ—å°‡ç”± Web Component æ¸²æŸ“ï¼Œæ­¤è™•ä¿ç•™ä½ˆå±€ç©ºé–“ */
        mobi-nav { display: block; height: 70px; }
    </style>
</head>
<body id="app">

<div class="container">
    <header style="margin-bottom: 30px;">
        <h1 style="font-size: 28px; font-weight: 800;">âš™ï¸ Beta æ§åˆ¶å°</h1>
        <p style="color: var(--text-sub); font-size: 14px;">è·¯å¾‘: /beta/index.html | è³‡æ–™åº«: data.json</p>
    </header>

    <!-- å€å¡Š 1: ç’°å¢ƒè¨­å®š -->
    <section class="card">
        <h2><i class="fa-solid fa-sliders"></i> ä»‹é¢å¼•æ“</h2>
        <select id="themeMode" onchange="MobiCore.updateTheme(this.value)">
            <option value="dark">æ·±é»‘æ¥µç°¡ (Standard)</option>
            <option value="light">æ˜äº®æ¨¡å¼ (Vibrant)</option>
        </select>
        <input type="range" min="14" max="22" value="16" id="fontSize" oninput="MobiCore.updateFont(this.value)">
    </section>

    <!-- å€å¡Š 2: è³‡æ–™æ“ä½œ -->
    <section class="card">
        <h2><i class="fa-solid fa-database"></i> JSON å…§å®¹ç®¡ç†</h2>
        <select id="dataType">
            <option value="shorts">Shorts å½±ç‰‡åº«</option>
            <option value="music">éŸ³æ¨‚ä¸²æµæ¸…å–®</option>
        </select>
        <input type="text" id="dataTitle" placeholder="æ¨™é¡Œå…§å®¹">
        <input type="url" id="dataUrl" placeholder="è³‡æºç¶²å€ (https://...)">
        
        <button onclick="MobiCore.processData()">
            <i class="fa-solid fa-bolt"></i> å°è£ä¸¦æ›´æ–° JSON
        </button>
        
        <div id="output-box"></div>
        <button id="saveGithubBtn" style="display:none; background:#24292e; margin-top:10px;" onclick="MobiCore.syncToGithub()">
            <i class="fa-brands fa-github"></i> è‡ªå‹•æ¨é€è‡³ GitHub å„²å­˜åº«
        </button>
    </section>
</div>

<!-- è‡ªå®šç¾© Web Component: ç„¡åˆ·æ–°å°è¦½åˆ— -->
<mobi-nav></mobi-nav>

<script>
/**
 * MobiCore - é«˜éšæ ¸å¿ƒé‚è¼¯
 * åŒ…å«ï¼šSPA è·¯ç”±ã€JSON é©—è­‰ã€GitHub API é€šè¨Š
 */
const MobiCore = {
    state: {
        db: { shorts: [], music: [] },
        config: { theme: 'dark', fontSize: 16 }
    },

    init() {
        this.loadLocal();
        this.render();
        console.log("MobiCore Beta å•Ÿå‹•æˆåŠŸ");
    },

    // 1. å‹•æ…‹æ¨£å¼æ§åˆ¶
    updateTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem('mobi_beta_theme', theme);
    },

    updateFont(size) {
        document.body.style.fontSize = `${size}px`;
        localStorage.setItem('mobi_beta_font', size);
    },

    // 2. JSON è³‡æ–™å°è£èˆ‡é©—è­‰
    processData() {
        const type = document.getElementById('dataType').value;
        const title = document.getElementById('dataTitle').value;
        const url = document.getElementById('dataUrl').value;

        if (!url.startsWith('http')) return alert("è«‹è¼¸å…¥åˆæ³•çš„ URL è·¯å¾‘ï¼");

        // çµæ§‹åŒ–å°è£
        const newItem = { id: Date.now(), title, url, timestamp: new Date().toISOString() };
        this.state.db[type].unshift(newItem);

        const output = document.getElementById('output-box');
        output.style.display = 'block';
        output.innerText = JSON.stringify(this.state.db, null, 2);
        document.getElementById('saveGithubBtn').style.display = 'block';
    },

    // 3. GitHub API é«˜éšåŒæ­¥ (å–ä»£æ‰‹å‹•è¤‡è£½)
    async syncToGithub() {
        const GITHUB_USER = "ä½ çš„å¸³è™Ÿ";
        const GITHUB_REPO = "ä½ çš„å€‰åº«å";
        const FILE_PATH = "beta/data.json";
        const TOKEN = "ä½ çš„_GITHUB_TOKEN"; // âš ï¸ å»ºè­°é€éå¾Œç«¯è½‰ç™¼ï¼Œå‰ç«¯æ¸¬è©¦ç”¨å¯æ”¾å…¥

        const apiPath = `https://api.github.com{GITHUB_USER}/${GITHUB_REPO}/contents/${FILE_PATH}`;

        try {
            // A. å…ˆå–å¾—ç¾æœ‰æª”æ¡ˆçš„ SHA
            const getRes = await fetch(apiPath);
            const fileInfo = await getRes.json();
            
            // B. é€²è¡Œ Base64 ç·¨ç¢¼
            const content = btoa(unescape(encodeURIComponent(JSON.stringify(this.state.db, null, 2))));

            // C. æ¨é€æ›´æ–°
            const putRes = await fetch(apiPath, {
                method: "PUT",
                headers: { "Authorization": `token ${TOKEN}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    message: "âš¡ Beta: è‡ªå‹•åŒæ­¥è³‡æ–™æ›´æ–°",
                    content: content,
                    sha: fileInfo.sha // å¿…è¦åƒæ•¸
                })
            });

            if (putRes.ok) alert("ğŸ‰ GitHub å„²å­˜æˆåŠŸï¼Action å·²è§¸ç™¼è‡ªå‹•éƒ¨ç½²ã€‚");
        } catch (err) {
            alert("åŒæ­¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ Token èˆ‡è·¯å¾‘è¨­å®šã€‚");
        }
    },

    loadLocal() {
        const theme = localStorage.getItem('mobi_beta_theme') || 'dark';
        const font = localStorage.getItem('mobi_beta_font') || 16;
        this.updateTheme(theme);
        this.updateFont(font);
        document.getElementById('themeMode').value = theme;
        document.getElementById('fontSize').value = font;
    },

    render() { /* SPA é é¢æ¸²æŸ“é‚è¼¯ */ }
};

// 4. Web Component: é«˜éšå°è¦½æ¨™ç±¤
class MobiNav extends HTMLElement {
    connectedCallback() {
        const currentPath = window.location.pathname;
        this.innerHTML = `
        <style>
            .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; height: 75px; background: var(--bg-card); border-top: 1px solid var(--border); display: flex; justify-content: space-around; align-items: center; z-index: 1000; backdrop-filter: blur(10px); }
            .nav-item { color: var(--text-sub); text-decoration: none; font-size: 11px; display: flex; flex-direction: column; align-items: center; gap: 5px; transition: var(--transition); }
            .nav-item.active { color: var(--accent-color); transform: translateY(-2px); }
            .nav-item i { font-size: 22px; }
        </style>
        <nav class="bottom-nav">
            <a href="/beta/index.html" class="nav-item ${currentPath.includes('index')?'active':''}" data-link><i class="fa-solid fa-gear"></i><span>è¨­å®š</span></a>
            <a href="/beta/shorts.html" class="nav-item" data-link><i class="fa-brands fa-youtube"></i><span>Shorts</span></a>
            <a href="/beta/music.html" class="nav-item" data-link><i class="fa-solid fa-music"></i><span>éŸ³æ¨‚</span></a>
        </nav>`;

        // ç„¡åˆ·æ–°æ›é æ””æˆªå™¨
        this.querySelectorAll('[data-link]').forEach(link => {
            link.onclick = (e) => {
                e.preventDefault();
                const path = link.getAttribute('href');
                history.pushState(null, '', path);
                // é€™è£¡è§¸ç™¼è·¯ç”±æ›´æ–°äº‹ä»¶
                window.dispatchEvent(new Event('popstate'));
            };
        });
    }
}
customElements.define('mobi-nav', MobiNav);

MobiCore.init();
</script>
</body>
</html>
